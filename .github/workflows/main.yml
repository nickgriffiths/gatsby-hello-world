# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the action will run. 
on:
  # Triggers the workflow on push or pull request events but only for the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    env:
      # Assume this is a PR build. If this is a master build, these will be overridden in the first step.
      BUILD_ID: pr-${{ github.event.number }}
      NETLIFY_STAGING_DEPLOY_ALIAS: deploy-preview-${{ github.event.number }}
      NETLIFY_STAGING_DEPLOY_URL: https://deploy-preview-${{ github.event.number }}--rexona-web-en-gb-staging.netlify.app

    steps:

      - name: Override job environment variables if running on master branch
        if: github.ref == 'refs/heads/master'
        shell: bash
        run: |
          echo "BUILD_ID=master" >> $GITHUB_ENV
          echo "NETLIFY_STAGING_DEPLOY_ALIAS=" >> $GITHUB_ENV
          echo "NETLIFY_STAGING_DEPLOY_URL=https://rexona-web-en-gb-staging.netlify.app" >> $GITHUB_ENV

      - name: Override job environment variables if running on release branch
        if: /refs\/heads\/(release.*$)/.test(github.ref)
        env:
          BRANCH_NAME: ${{ github.ref.match(/refs\/heads\/(release.*$)/)[1] }}
        shell: bash
        run: |
          echo "BUILD_ID=${{ env.BRANCH_NAME }}" >> $GITHUB_ENV
          echo "NETLIFY_STAGING_DEPLOY_ALIAS=${{ env.BRANCH_NAME }}" >> $GITHUB_ENV
          echo "NETLIFY_STAGING_DEPLOY_URL=https://rexona-web-en-gb-staging.netlify.app" >> $GITHUB_ENV

      - uses: actions/checkout@v2
      - name: Build website
        run: echo "Build website here"
      - name: Deploy to staging
        run: echo "Deploy to staging Netlify instance here"
      - name: Run tests
        run: echo "Tests go here"
